<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.typekit.net/loa3imd.css">
    <link rel="stylesheet" href="./style.css">
    <script src="./validateForm.js" type="module"></script>
    <!-- Send report to Niels' php-->
    <script src='./newQ.js'></script>
    <script>
      const manipulateForm = function (e) {
          e.preventDefault();
          // læs m ajax
          let oReq = new XMLHttpRequest();
          oReq.addEventListener("load", function () {
              let hentet = [];
              if (this.responseText.length > 0)
                  hentet = JSON.parse(this.responseText); // get and objectify
              // udvid array m indtastet
              debugger;
              let n = $('name').value;
              let p = $('phone').value;
              let t = $('timestamp').value;
              let s = $('subject').value;
              let l = $('location').value;
              let m = $('malfunction').value;

              let o = {
                  name: n,
                  phone: p,
                  timestamp: t,
                  subject: s, 
                  location: l,
                  malfunction: m

              };
              hentet.push(o);                             // add new
              $('json').value = JSON.stringify(hentet);   // stringify
              document.forms['reportForm'].submit();          // send

          });
          oReq.open("GET", "http://www.dkexit.eu/tf/getIncidents.php");
          oReq.send();
      };
      const doThis = function () {
          headAndShoulders('ExamProject Dec 2020');
          feet(2020);
          $('formSubmit').addEventListener('click', manipulateForm)
      };
      window.addEventListener('load', doThis);
  </script>

  </head>

  <body>
    <main>
      <div id="logo">
        <a href="./index.html"><img id="indexLogo" src="./img/toenderFestival.svg" alt="homeLogo"></a>
        <hr>
      </div>
      <form class="report_Form" id="reportForm" name="reportForm" action="http://www.dkexit.eu/tf/receiveAndStore.php" method="POST">
        <div id="reportDiv">

          <h1 class="headline">Meld fejl</h1>
          <input class="report_Form" type="text" placeholder="Navn" name="name" id="name" required>

          <input class="report_Form" type="text" placeholder="Telefonnummer" name="phone" id="phone" required>
          <input id='json' name='json' type='hidden' value='' readonly/>
         
          <input class="report_Form" type="text" name="timestamp" id="timestamp" hidden="true"></input>
          <hr>

          <input class="report_Form" type="text" placeholder="Indtast emne" name="subject" id="subject" required>


          <div>
            <datalist class="report_Form" id="suggestions">
              <option>Plads 1</option>
              <option>Plads 2</option>
              <option>Toilet</option>
              <option>Scene 1</option>
              <option>Plads 36</option>
              <option>Plads 56</option>
            </datalist>
            <input placeholder="Vælg lokation" autoComplete="on" name="location" id="location" list="suggestions" onfocus="this.value=''" required />
          </div>
          <input class="report_Form" type="text" placeholder="Beskriv fejlen" name="malfunction" id="malfunction" required>
          <br>
          <form method='post' action='' enctype="multipart/form-data">

            <input class="report_Form" style="display:none;" class="btn btn-secondary" type="file" id='files' name="files[]" multiple>
            <label class="button img" for="files"></label>
            <p id="preview"></p>
          </form>
          
          <p><img id="preview" width="200" /></p>

          <input type="submit" value="Send" name="formSubmit" id="formSubmit">
        </div>
      </form>

      <p class="results_display" id="results_display"></p>
    </main>

    <footer id="footer">

      <div onclick="window.location.href='./index.html'">
        <img src="./img/homeStroke.svg" alt="homeFill" class="footerImg">
      </div>
      <div onclick="window.location.href='#'">
        <img src="./img/reportFill.svg" alt="reportStroke" class="footerImg">
      </div>
      <div onclick="window.location.href='./azguide.html'">
        <img src="./img/AZguideStroke.svg" alt="AZguideStroke" class="footerImg">
      </div>
      <div onclick="window.location.href='./overview-reports.html'">
        <img src="./img/overviewStroke.svg" alt="overviewStroke" class="footerImg">
      </div>


    </footer>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

  </body>

</html>
